#!/bin/sh

echo "Checking for required system dependencies..."

# Function to check if a package is installed
check_package() {
    dpkg -s "$1" >/dev/null 2>&1
}

# Function to check if a command exists
check_command() {
    command -v "$1" >/dev/null 2>&1
}

# List of required system packages
REQUIRED_PKGS=("libcurl4-openssl-dev" "libssl-dev" "cmake" "libxml2-dev" "build-essential")

MISSING_PKGS=()

# Check each package
for pkg in "${REQUIRED_PKGS[@]}"; do
    if ! check_package "$pkg"; then
        MISSING_PKGS+=("$pkg")
    fi
done

# Check if `make` is installed
if ! check_command "make"; then
    MISSING_PKGS+=("build-essential")  # Ensures make, gcc, and other essential tools are installed
fi

# If missing packages found, prompt user
if [ ${#MISSING_PKGS[@]} -gt 0 ]; then
    echo "The following required packages are missing:"
    echo "${MISSING_PKGS[@]}"
    echo "Please install them using:"
    echo "  sudo apt update && sudo apt install -y ${MISSING_PKGS[@]}"
    exit 1
else
    echo "All required system dependencies are installed."
fi

exit 0
